<Window x:Class="App.Desktop.ExcelImportWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        Title="Excel Import Sihirbazı" Height="820" Width="1280"
        WindowStartupLocation="CenterOwner"
        Background="{DynamicResource MaterialDesignPaper}">
    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <StackPanel Grid.Row="0" Margin="0,0,0,16">
            <TextBlock Text="Excel Import Sihirbazı" FontSize="24" FontWeight="SemiBold" />
            <TextBlock Text="Sayaç ve kofre kayıtlarını 6 adımda içe aktarın." Foreground="#7B8796" />
        </StackPanel>

        <TabControl Grid.Row="1"
                    SelectedIndex="{Binding CurrentStepIndex, Mode=TwoWay}"
                    TabStripPlacement="Left">
            <TabItem Header="1. Dosya Seç">
                <Grid Margin="24">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <TextBlock Text="Dosya Seçimi" FontSize="18" FontWeight="SemiBold" />
                    <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,16,0,0">
                        <TextBox Width="480" Height="38" Text="{Binding FilePath}" materialDesign:HintAssist.Hint="Excel dosya yolu" />
                        <Button Margin="12,0,0,0" Style="{StaticResource MaterialDesignContainedButton}" Content="Dosya Seç" Command="{Binding BrowseFileCommand}" />
                    </StackPanel>
                    <materialDesign:Card Grid.Row="2" Margin="0,24,0,0" Padding="16">
                        <TextBlock Text="Yalnızca .xlsx ve .xls dosyaları desteklenir. Dosya seçimi sonrası otomatik olarak sayfalar yüklenir." TextWrapping="Wrap" />
                    </materialDesign:Card>
                </Grid>
            </TabItem>

            <TabItem Header="2. Sayfa Seç">
                <Grid Margin="24">
                    <TextBlock Text="Çalışma Sayfası" FontSize="18" FontWeight="SemiBold" />
                    <StackPanel Margin="0,16,0,0">
                        <ComboBox Width="320" ItemsSource="{Binding Sheets}" SelectedItem="{Binding SelectedSheet}" />
                        <TextBlock Text="Seçili sayfanın başlıkları bir sonraki adımda görüntülenecek." Margin="0,12,0,0" Foreground="#7B8796" />
                    </StackPanel>
                </Grid>
            </TabItem>

            <TabItem Header="3. Kolon Eşleme">
                <Grid Margin="24">
                    <TextBlock Text="Kolon Eşleme" FontSize="18" FontWeight="SemiBold" />
                    <DataGrid Margin="0,16,0,0" AutoGenerateColumns="False" ItemsSource="{Binding Mappings}" HeadersVisibility="Column">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Hedef Alan" Binding="{Binding TargetField}" IsReadOnly="True" Width="*" />
                            <DataGridComboBoxColumn Header="Excel Kolonu"
                                                     Width="2*"
                                                     SelectedItemBinding="{Binding SourceColumn, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                     ItemsSource="{Binding DataContext.Headers, RelativeSource={RelativeSource AncestorType=DataGrid}}" />
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>

            <TabItem Header="4. Doğrulama">
                <Grid Margin="24">
                    <TextBlock Text="Doğrulama Sonuçları" FontSize="18" FontWeight="SemiBold" />
                    <ListBox Margin="0,16,0,0" ItemsSource="{Binding ValidationIssues}">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="{Binding Severity}" FontWeight="SemiBold" Margin="0,0,8,0" />
                                    <TextBlock Text="{Binding Message}" />
                                </StackPanel>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </Grid>
            </TabItem>

            <TabItem Header="5. Önizleme">
                <Grid Margin="24">
                    <TextBlock Text="İlk 10 Satır Önizleme" FontSize="18" FontWeight="SemiBold" />
                    <ListBox Margin="0,16,0,0" ItemsSource="{Binding PreviewRows}">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding DisplayText}" TextWrapping="Wrap" />
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </Grid>
            </TabItem>

            <TabItem Header="6. Özet">
                <Grid Margin="24">
                    <TextBlock Text="Import Özeti" FontSize="18" FontWeight="SemiBold" />
                    <StackPanel Margin="0,16,0,0">
                        <TextBlock Text="{Binding ImportSummary}" FontSize="14" />
                        <StackPanel Orientation="Horizontal" Margin="0,12,0,0">
                            <materialDesign:Chip Content="{Binding ImportedCount, StringFormat=Hazır Kayıt: {0}}" Margin="0,0,12,0" />
                            <materialDesign:Chip Content="{Binding ErrorCount, StringFormat=Kritik Uyarı: {0}}" />
                        </StackPanel>
                        <Button Margin="0,24,0,0" Style="{StaticResource MaterialDesignContainedButton}" Content="İçe Aktarımı Başlat (Yakında)" IsEnabled="False" />
                    </StackPanel>
                </Grid>
            </TabItem>
        </TabControl>

        <DockPanel Grid.Row="2" Margin="0,16,0,0">
            <Button DockPanel.Dock="Left" Style="{StaticResource MaterialDesignOutlinedButton}" Content="Geri" Command="{Binding PreviousStepCommand}" />
            <Button DockPanel.Dock="Right" Style="{StaticResource MaterialDesignContainedButton}" Content="İleri" Command="{Binding NextStepCommand}" />
        </DockPanel>
    </Grid>
</Window>
